{"version":3,"sources":["controllers/image-detail-controller/image-detail-controller.es6"],"names":["USER_ID","ImageDetailController","$scope","detailImageService","$mdDialog","toaster","imageService","init","like","dislike","image","getImage","SetLikeToImage","setLike","AddLike","DeleteLike","id","setDislike","addComment","nickname","text","commentForm","$valid","commentText","comment","own","date","Date","now","then","comments","push","catch","ErrorHandler","pop","deleteComment","data","ok","filter","_comment","$apply","countActions","action","image_likes","like_type","length","close","cancel","type","addLike","imageId","userId","deleteLike","forEach","el","ind","arr","err","console","log","$inject"],"mappings":"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","file":"image-detail-controller.js","sourcesContent":["import {GUID} from '../../additional/GUID'\r\n\r\nconst USER_ID = 'user';\r\n\r\nclass ImageDetailController {\r\n    constructor($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        this.init($scope, detailImageService, $mdDialog, toaster, imageService);\r\n    }\r\n\r\n    init($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n\r\n        $scope.like = false;\r\n        $scope.dislike = false;\r\n\r\n        $scope.image = detailImageService.getImage();\r\n        SetLikeToImage($scope.image);\r\n\r\n        $scope.setLike = () => {\r\n            if ($scope.like === false) {\r\n                AddLike('like');\r\n            }\r\n            if ($scope.dislike === true && $scope.like === false) {\r\n                $scope.dislike = false;\r\n            } else if ($scope.like === true) {\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.like = !$scope.like;\r\n        };\r\n\r\n        $scope.setDislike = () => {\r\n            if ($scope.dislike === false) {\r\n                AddLike('dislike');\r\n            }\r\n            if ($scope.dislike === false && $scope.like === true) {\r\n                $scope.like = false;\r\n            } else if ($scope.dislike === true) {\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.dislike = !$scope.dislike;\r\n        };\r\n\r\n        $scope.addComment = (nickname, text) => {\r\n            if ($scope.commentForm.$valid) {\r\n                $scope.nickname = '';\r\n                $scope.commentText = '';\r\n\r\n                var comment = {\r\n                    id: GUID(2),\r\n                    own: nickname,\r\n                    text: text,\r\n                    date: Date.now()\r\n                };\r\n\r\n                imageService.addComment($scope.image.id, comment).then((image)=> {\r\n                    $scope.image.comments.push(comment);\r\n                }).catch(ErrorHandler);\r\n            } else {\r\n                toaster.pop('warning', \"Ошибка\", \"Заполните все поля.\");\r\n            }\r\n        };\r\n\r\n        $scope.deleteComment = (image, comment) => {\r\n            imageService.deleteComment(image.id, comment.id).then((data)=> {\r\n                if (data.ok === true) {\r\n                    $scope.image.comments = image.comments.filter( _comment => _comment.id !== comment.id);\r\n                    toaster.pop('info', \"Успешно\", \"Коментарий удален.\");\r\n                    $scope.$apply();\r\n                }\r\n            }).catch(ErrorHandler);\r\n        };\r\n\r\n        $scope.countActions = (image, action) => {\r\n            return image.image_likes\r\n                .filter(like => like.like_type === action)\r\n                .length;\r\n        };\r\n\r\n        $scope.close = () => {\r\n            $mdDialog.cancel();\r\n        };\r\n\r\n        function AddLike(type) {\r\n            imageService.addLike($scope.image.id, {\r\n                like_type: type,\r\n                own: USER_ID\r\n            }).then((data)=> {\r\n                $scope.image.image_likes = data.image_likes;\r\n                $scope.$apply();\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function DeleteLike(imageId, userId) {\r\n            imageService.deleteLike(imageId, userId).then((data)=> {\r\n                $scope.image.image_likes = data.image_likes;\r\n                $scope.$apply();\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function SetLikeToImage(image) {\r\n            image.image_likes.forEach((el, ind, arr)=> {\r\n                if (el.like_type === 'like' && el.own === USER_ID) {\r\n                    $scope.like = true;\r\n                } else if (el.like_type === 'dislike' && el.own === USER_ID) {\r\n                    $scope.dislike = true;\r\n                }\r\n            });\r\n        }\r\n\r\n        function ErrorHandler(err) {\r\n            console.log(err);\r\n            toaster.pop('info', \"Ошибка\", \"Произошла ошибка\");\r\n        }\r\n    }\r\n}\r\n\r\nImageDetailController.$inject = ['$scope', 'detailImageService', '$mdDialog', 'toaster', 'imageService'];\r\nexport {ImageDetailController}"]}