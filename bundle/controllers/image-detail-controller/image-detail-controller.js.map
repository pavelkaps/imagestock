{"version":3,"sources":["controllers/image-detail-controller/image-detail-controller.es6"],"names":["USER_ID","ImageDetailController","$scope","detailImageService","$mdDialog","toaster","imageService","init","like","dislike","image","getImage","SetLikeToImage","setLike","AddLike","DeleteLike","id","setDislike","addComment","nickname","text","commentForm","$valid","commentText","comment","own","date","Date","now","then","comments","push","catch","ErrorHandler","pop","countActions","action","count","image_likes","forEach","el","ind","arr","like_type","close","cancel","type","addLike","data","console","log","imageId","userId","deleteLike","err","$inject"],"mappings":"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","file":"image-detail-controller.js","sourcesContent":["const USER_ID = 'user';\r\n\r\nclass ImageDetailController {\r\n    constructor($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        this.init($scope, detailImageService, $mdDialog, toaster, imageService);\r\n    }\r\n\r\n    init($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        \r\n        $scope.like = false;\r\n        $scope.dislike = false;\r\n\r\n        $scope.image = detailImageService.getImage();\r\n        SetLikeToImage($scope.image);\r\n\r\n        $scope.setLike = () => {\r\n            if($scope.like === false){\r\n                AddLike('like');\r\n            }\r\n            if ($scope.dislike === true && $scope.like === false) {\r\n                $scope.dislike = false;\r\n            }else if($scope.like === true){\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.like = !$scope.like;\r\n\r\n        };\r\n\r\n        $scope.setDislike = () => {\r\n            if($scope.dislike === false){\r\n                AddLike('dislike');\r\n            }\r\n            if ($scope.dislike === false && $scope.like === true) {\r\n                $scope.like = false;\r\n            }else if($scope.dislike === true){\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.dislike = !$scope.dislike;\r\n        };\r\n\r\n        $scope.addComment = (nickname, text) => {\r\n            if ($scope.commentForm.$valid) {\r\n                $scope.nickname = '';\r\n                $scope.commentText = '';\r\n\r\n                var comment = {\r\n                    own: nickname,\r\n                    text:  text,\r\n                    date:  Date.now()\r\n                };\r\n\r\n                imageService.addComment($scope.image.id, comment).then((image)=>{\r\n                    $scope.image.comments.push(comment);\r\n                }).catch(ErrorHandler);\r\n            } else {\r\n                toaster.pop('warning', \"Ошибка\", \"Заполните все поля.\");\r\n            }\r\n        };\r\n\r\n        $scope.countActions = (image, action) => {\r\n            var count = 0;\r\n            image.image_likes.forEach((el, ind, arr) => {\r\n                if (el.like_type === action) {\r\n                    count++;\r\n                }\r\n            });\r\n            return count;\r\n        };\r\n\r\n        $scope.close = () => {\r\n            $mdDialog.cancel();\r\n        };\r\n\r\n        function AddLike(type) {\r\n            imageService.addLike($scope.image.id, {\r\n                like_type: type,\r\n                own: USER_ID\r\n            }).then((data)=>{\r\n                $scope.image.image_likes = data;\r\n                console.log(data);\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function DeleteLike(imageId, userId) {\r\n            imageService.deleteLike(imageId, userId).then((data)=>{\r\n                $scope.image.image_likes = data;\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function SetLikeToImage(image) {\r\n            image.image_likes.forEach((el, ind, arr)=>{\r\n                if(el.like_type === 'like' && el.own === USER_ID){\r\n                    $scope.like = true;\r\n                }else if(el.like_type === 'dislike' && el.own === USER_ID){\r\n                    $scope.dislike = true;\r\n                }\r\n            });\r\n        }\r\n\r\n        function ErrorHandler(err){\r\n            console.log(err);\r\n            toaster.pop('info', \"Ошибка\", \"Произошла ошибка\");\r\n        }\r\n    }\r\n}\r\n\r\nImageDetailController.$inject = ['$scope', 'detailImageService', '$mdDialog', 'toaster','imageService'];\r\nexport {ImageDetailController}"]}