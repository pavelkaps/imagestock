{"version":3,"sources":["controllers/image-detail-controller/image-detail-controller.es6"],"names":["USER_ID","ImageDetailController","$scope","detailImageService","$mdDialog","toaster","imageService","init","like","dislike","image","getImage","SetLikeToImage","setLike","AddLike","DeleteLike","id","setDislike","addComment","nickname","text","commentForm","$valid","commentText","comment","own","date","Date","now","subscribe","console","log","comments","push","$apply","ErrorHandler","pop","deleteComment","data","ok","filter","_comment","countActions","action","image_likes","like_type","length","close","cancel","type","addLike","imageId","userId","deleteLike","err","$inject"],"mappings":";;;;;;;;;AAAA;;;;AAEA,IAAMA,UAAU,MAAhB;;IAEMC,qB;AACF,mCAAYC,MAAZ,EAAoBC,kBAApB,EAAwCC,SAAxC,EAAmDC,OAAnD,EAA4DC,YAA5D,EAA0E;AAAA;;AACtE,aAAKC,IAAL,CAAUL,MAAV,EAAkBC,kBAAlB,EAAsCC,SAAtC,EAAiDC,OAAjD,EAA0DC,YAA1D;AACH;;;;6BAEIJ,M,EAAQC,kB,EAAoBC,S,EAAWC,O,EAASC,Y,EAAc;;AAE/DJ,mBAAOM,IAAP,GAAc,KAAd;AACAN,mBAAOO,OAAP,GAAiB,KAAjB;;AAEAP,mBAAOQ,KAAP,GAAeP,mBAAmBQ,QAAnB,EAAf;AACAC,2BAAeV,OAAOQ,KAAtB;;AAEAR,mBAAOW,OAAP,GAAiB,YAAM;AACnB,oBAAIX,OAAOM,IAAP,KAAgB,KAApB,EAA2B;AACvBM,4BAAQ,MAAR;AACH;AACD,oBAAIZ,OAAOO,OAAP,KAAmB,IAAnB,IAA2BP,OAAOM,IAAP,KAAgB,KAA/C,EAAsD;AAClDN,2BAAOO,OAAP,GAAiB,KAAjB;AACH,iBAFD,MAEO,IAAIP,OAAOM,IAAP,KAAgB,IAApB,EAA0B;AAC7BO,+BAAWb,OAAOQ,KAAP,CAAaM,EAAxB,EAA4BhB,OAA5B;AACH;AACDE,uBAAOM,IAAP,GAAc,CAACN,OAAOM,IAAtB;AACH,aAVD;;AAYAN,mBAAOe,UAAP,GAAoB,YAAM;AACtB,oBAAIf,OAAOO,OAAP,KAAmB,KAAvB,EAA8B;AAC1BK,4BAAQ,SAAR;AACH;AACD,oBAAIZ,OAAOO,OAAP,KAAmB,KAAnB,IAA4BP,OAAOM,IAAP,KAAgB,IAAhD,EAAsD;AAClDN,2BAAOM,IAAP,GAAc,KAAd;AACH,iBAFD,MAEO,IAAIN,OAAOO,OAAP,KAAmB,IAAvB,EAA6B;AAChCM,+BAAWb,OAAOQ,KAAP,CAAaM,EAAxB,EAA4BhB,OAA5B;AACH;AACDE,uBAAOO,OAAP,GAAiB,CAACP,OAAOO,OAAzB;AACH,aAVD;;AAYAP,mBAAOgB,UAAP,GAAoB,UAACC,QAAD,EAAWC,IAAX,EAAoB;AACpC,oBAAIlB,OAAOmB,WAAP,CAAmBC,MAAvB,EAA+B;AAC3BpB,2BAAOiB,QAAP,GAAkB,EAAlB;AACAjB,2BAAOqB,WAAP,GAAqB,EAArB;;AAEA,wBAAIC,UAAU;AACVR,4BAAI,gBAAK,CAAL,CADM;AAEVS,6BAAKN,QAFK;AAGVC,8BAAMA,IAHI;AAIVM,8BAAMC,KAAKC,GAAL;AAJI,qBAAd;;AAOAtB,iCAAaY,UAAb,CAAwBhB,OAAOQ,KAAP,CAAaM,EAArC,EAAyCQ,OAAzC,EACCK,SADD,CACW,UAACnB,KAAD,EAAU;AACboB,gCAAQC,GAAR,CAAY,eAAZ,EAA6BrB,KAA7B;AACAR,+BAAOQ,KAAP,CAAasB,QAAb,CAAsBC,IAAtB,CAA2BT,OAA3B;AACAtB,+BAAOgC,MAAP;AACH,qBALL,EAMIC,YANJ;AAOH,iBAlBD,MAkBO;AACH9B,4BAAQ+B,GAAR,CAAY,SAAZ,EAAuB,QAAvB,EAAiC,qBAAjC;AACH;AACJ,aAtBD;;AAwBAlC,mBAAOmC,aAAP,GAAuB,UAAC3B,KAAD,EAAQc,OAAR,EAAoB;AACvClB,6BAAa+B,aAAb,CAA2B3B,MAAMM,EAAjC,EAAqCQ,QAAQR,EAA7C,EACCa,SADD,CACW,UAACS,IAAD,EAAS;AAChBR,4BAAQC,GAAR,CAAY,WAAZ,EAAyBO,IAAzB;AACA,wBAAIA,KAAKC,EAAL,KAAY,IAAhB,EAAsB;AAClBrC,+BAAOQ,KAAP,CAAasB,QAAb,GAAwBtB,MAAMsB,QAAN,CAAeQ,MAAf,CAAuB;AAAA,mCAAYC,SAASzB,EAAT,KAAgBQ,QAAQR,EAApC;AAAA,yBAAvB,CAAxB;AACAX,gCAAQ+B,GAAR,CAAY,MAAZ,EAAoB,SAApB,EAA+B,oBAA/B;AACAlC,+BAAOgC,MAAP;AACH;AACJ,iBARD,EASAC,YATA;AAWH,aAZD;;AAcAjC,mBAAOwC,YAAP,GAAsB,UAAChC,KAAD,EAAQiC,MAAR,EAAmB;AACrC,uBAAOjC,MAAMkC,WAAN,CACFJ,MADE,CACK;AAAA,2BAAQhC,KAAKqC,SAAL,KAAmBF,MAA3B;AAAA,iBADL,EAEFG,MAFL;AAGH,aAJD;;AAMA5C,mBAAO6C,KAAP,GAAe,YAAM;AACjB3C,0BAAU4C,MAAV;AACH,aAFD;;AAIA,qBAASlC,OAAT,CAAiBmC,IAAjB,EAAuB;AACnB3C,6BAAa4C,OAAb,CAAqBhD,OAAOQ,KAAP,CAAaM,EAAlC,EAAsC;AAClC6B,+BAAWI,IADuB;AAElCxB,yBAAKzB;AAF6B,iBAAtC,EAGG6B,SAHH,CAGa,UAACS,IAAD,EAAS;AAClBR,4BAAQC,GAAR,CAAY,YAAZ,EAA0BO,IAA1B;AACApC,2BAAOQ,KAAP,CAAakC,WAAb,GAA2BN,KAAKM,WAAhC;AACA1C,2BAAOgC,MAAP;AACH,iBAPD,EAOEC,YAPF;AAQH;;AAED,qBAASpB,UAAT,CAAoBoC,OAApB,EAA6BC,MAA7B,EAAqC;AACjC9C,6BAAa+C,UAAb,CAAwBF,OAAxB,EAAiCC,MAAjC,EACCvB,SADD,CACW,UAACS,IAAD,EAAS;AAChBR,4BAAQC,GAAR,CAAY,eAAZ,EAA6BO,IAA7B;AACApC,2BAAOQ,KAAP,CAAakC,WAAb,GAA2BN,KAAKM,WAAhC;AACA1C,2BAAOgC,MAAP;AACH,iBALD,EAKEC,YALF;AAMH;;AAED,qBAASvB,cAAT,CAAwBF,KAAxB,EAA+B;AAC3BR,uBAAOM,IAAP,GAAc,CAAC,CAACE,MAAMkC,WAAN,CACSJ,MADT,CACgB,UAAChC,IAAD;AAAA,2BAASA,KAAKqC,SAAL,KAAmB,MAAnB,IAA6BrC,KAAKiB,GAAL,KAAazB,OAAnD;AAAA,iBADhB,EAES8C,MAFzB;AAGA5C,uBAAOO,OAAP,GAAiB,CAAC,CAACC,MAAMkC,WAAN,CACMJ,MADN,CACa,UAAChC,IAAD;AAAA,2BAASA,KAAKqC,SAAL,KAAmB,SAAnB,IAAgCrC,KAAKiB,GAAL,KAAazB,OAAtD;AAAA,iBADb,EAEM8C,MAFzB;AAGH;;AAED,qBAASX,YAAT,CAAsBmB,GAAtB,EAA2B;AACvBxB,wBAAQC,GAAR,CAAYuB,GAAZ;AACAjD,wBAAQ+B,GAAR,CAAY,MAAZ,EAAoB,QAApB,EAA8B,kBAA9B;AACH;AACJ;;;;;;AAGLnC,sBAAsBsD,OAAtB,GAAgC,CAAC,QAAD,EAAW,oBAAX,EAAiC,WAAjC,EAA8C,SAA9C,EAAyD,cAAzD,CAAhC;QACQtD,qB,GAAAA,qB","file":"image-detail-controller.js","sourcesContent":["import {GUID} from '../../additional/GUID'\r\n\r\nconst USER_ID = 'user';\r\n\r\nclass ImageDetailController {\r\n    constructor($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        this.init($scope, detailImageService, $mdDialog, toaster, imageService);\r\n    }\r\n\r\n    init($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n\r\n        $scope.like = false;\r\n        $scope.dislike = false;\r\n\r\n        $scope.image = detailImageService.getImage();\r\n        SetLikeToImage($scope.image);\r\n\r\n        $scope.setLike = () => {\r\n            if ($scope.like === false) {\r\n                AddLike('like');\r\n            }\r\n            if ($scope.dislike === true && $scope.like === false) {\r\n                $scope.dislike = false;\r\n            } else if ($scope.like === true) {\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.like = !$scope.like;\r\n        };\r\n\r\n        $scope.setDislike = () => {\r\n            if ($scope.dislike === false) {\r\n                AddLike('dislike');\r\n            }\r\n            if ($scope.dislike === false && $scope.like === true) {\r\n                $scope.like = false;\r\n            } else if ($scope.dislike === true) {\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.dislike = !$scope.dislike;\r\n        };\r\n\r\n        $scope.addComment = (nickname, text) => {\r\n            if ($scope.commentForm.$valid) {\r\n                $scope.nickname = '';\r\n                $scope.commentText = '';\r\n\r\n                var comment = {\r\n                    id: GUID(2),\r\n                    own: nickname,\r\n                    text: text,\r\n                    date: Date.now()\r\n                };\r\n\r\n                imageService.addComment($scope.image.id, comment)\r\n                .subscribe((image)=> {\r\n                        console.log('add comment: ', image );\r\n                        $scope.image.comments.push(comment);\r\n                        $scope.$apply();\r\n                    },\r\n                    ErrorHandler);\r\n            } else {\r\n                toaster.pop('warning', \"Ошибка\", \"Заполните все поля.\");\r\n            }\r\n        };\r\n\r\n        $scope.deleteComment = (image, comment) => {\r\n            imageService.deleteComment(image.id, comment.id)\r\n            .subscribe((data)=> {\r\n                console.log('delete - ', data);\r\n                if (data.ok === true) {\r\n                    $scope.image.comments = image.comments.filter( _comment => _comment.id !== comment.id);\r\n                    toaster.pop('info', \"Успешно\", \"Коментарий удален.\");\r\n                    $scope.$apply();\r\n                }\r\n            },\r\n            ErrorHandler\r\n            );\r\n        };\r\n\r\n        $scope.countActions = (image, action) => {\r\n            return image.image_likes\r\n                .filter(like => like.like_type === action)\r\n                .length;\r\n        };\r\n\r\n        $scope.close = () => {\r\n            $mdDialog.cancel();\r\n        };\r\n\r\n        function AddLike(type) {\r\n            imageService.addLike($scope.image.id, {\r\n                like_type: type,\r\n                own: USER_ID\r\n            }).subscribe((data)=> {\r\n                console.log('add like: ', data);\r\n                $scope.image.image_likes = data.image_likes;\r\n                $scope.$apply();\r\n            },ErrorHandler);\r\n        }\r\n\r\n        function DeleteLike(imageId, userId) {\r\n            imageService.deleteLike(imageId, userId)\r\n            .subscribe((data)=> {\r\n                console.log('delete like: ', data)\r\n                $scope.image.image_likes = data.image_likes;\r\n                $scope.$apply();\r\n            },ErrorHandler);\r\n        }\r\n\r\n        function SetLikeToImage(image) {\r\n            $scope.like = !!image.image_likes\r\n                                    .filter((like)=> like.like_type === 'like' && like.own === USER_ID)\r\n                                    .length;\r\n            $scope.dislike = !!image.image_likes\r\n                                    .filter((like)=> like.like_type === 'dislike' && like.own === USER_ID)\r\n                                    .length;                  \r\n        }\r\n\r\n        function ErrorHandler(err) {\r\n            console.log(err);\r\n            toaster.pop('info', \"Ошибка\", \"Произошла ошибка\");\r\n        }\r\n    }\r\n}\r\n\r\nImageDetailController.$inject = ['$scope', 'detailImageService', '$mdDialog', 'toaster', 'imageService'];\r\nexport {ImageDetailController}"]}