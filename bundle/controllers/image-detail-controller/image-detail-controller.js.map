{"version":3,"sources":["controllers/image-detail-controller/image-detail-controller.es6"],"names":["USER_ID","ImageDetailController","$scope","detailImageService","$mdDialog","toaster","imageService","init","like","dislike","image","getImage","SetLikeToImage","setLike","AddLike","DeleteLike","id","setDislike","addComment","nickname","text","commentForm","$valid","commentText","comment","own","date","Date","now","then","comments","push","catch","ErrorHandler","pop","deleteComment","data","ok","find","el","index","arr","splice","countActions","action","count","image_likes","forEach","ind","like_type","close","cancel","type","addLike","console","log","imageId","userId","deleteLike","err","$inject"],"mappings":"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","file":"image-detail-controller.js","sourcesContent":["import {GUID} from '../../additional/GUID'\r\n\r\nconst USER_ID = 'user';\r\n\r\nclass ImageDetailController {\r\n    constructor($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        this.init($scope, detailImageService, $mdDialog, toaster, imageService);\r\n    }\r\n\r\n    init($scope, detailImageService, $mdDialog, toaster, imageService) {\r\n        \r\n        $scope.like = false;\r\n        $scope.dislike = false;\r\n\r\n        $scope.image = detailImageService.getImage();\r\n        SetLikeToImage($scope.image);\r\n\r\n        $scope.setLike = () => {\r\n            if($scope.like === false){\r\n                AddLike('like');\r\n            }\r\n            if ($scope.dislike === true && $scope.like === false) {\r\n                $scope.dislike = false;\r\n            }else if($scope.like === true){\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.like = !$scope.like;\r\n        };\r\n\r\n        $scope.setDislike = () => {\r\n            if($scope.dislike === false){\r\n                AddLike('dislike');\r\n            }\r\n            if ($scope.dislike === false && $scope.like === true) {\r\n                $scope.like = false;\r\n            }else if($scope.dislike === true){\r\n                DeleteLike($scope.image.id, USER_ID);\r\n            }\r\n            $scope.dislike = !$scope.dislike;\r\n        };\r\n\r\n        $scope.addComment = (nickname, text) => {\r\n            if ($scope.commentForm.$valid) {\r\n                $scope.nickname = '';\r\n                $scope.commentText = '';\r\n\r\n                var comment = {\r\n                    id: GUID(2),\r\n                    own: nickname,\r\n                    text:  text,\r\n                    date:  Date.now()\r\n                };\r\n\r\n                imageService.addComment($scope.image.id, comment).then((image)=>{\r\n                    $scope.image.comments.push(comment);\r\n                }).catch(ErrorHandler);\r\n            } else {\r\n                toaster.pop('warning', \"Ошибка\", \"Заполните все поля.\");\r\n            }\r\n        };\r\n        \r\n        $scope.deleteComment = (image, comment) =>{\r\n            imageService.deleteComment(image.id, comment.id).then((data)=>{\r\n                if(data.ok === true){\r\n                    image.comments.find((el, index, arr)=>{\r\n                        if(el.id === comment.id){\r\n                            image.comments.splice(index, 1);\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    });\r\n                    toaster.pop('info', \"Успешно\", \"Коментарий удален.\");\r\n                }\r\n            }).catch(ErrorHandler);\r\n        };\r\n\r\n        $scope.countActions = (image, action) => {\r\n            var count = 0;\r\n            image.image_likes.forEach((el, ind, arr) => {\r\n                if (el.like_type === action) {\r\n                    count++;\r\n                }\r\n            });\r\n            return count;\r\n        };\r\n\r\n        $scope.close = () => {\r\n            $mdDialog.cancel();\r\n        };\r\n\r\n        function AddLike(type) {\r\n            imageService.addLike($scope.image.id, {\r\n                like_type: type,\r\n                own: USER_ID\r\n            }).then((data)=>{\r\n                $scope.image.image_likes = data;\r\n                console.log(data);\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function DeleteLike(imageId, userId) {\r\n            imageService.deleteLike(imageId, userId).then((data)=>{\r\n                $scope.image.image_likes = data;\r\n            }).catch(ErrorHandler);\r\n        }\r\n\r\n        function SetLikeToImage(image) {\r\n            image.image_likes.forEach((el, ind, arr)=>{\r\n                if(el.like_type === 'like' && el.own === USER_ID){\r\n                    $scope.like = true;\r\n                }else if(el.like_type === 'dislike' && el.own === USER_ID){\r\n                    $scope.dislike = true;\r\n                }\r\n            });\r\n        }\r\n\r\n        function ErrorHandler(err){\r\n            console.log(err);\r\n            toaster.pop('info', \"Ошибка\", \"Произошла ошибка\");\r\n        }\r\n    }\r\n}\r\n\r\nImageDetailController.$inject = ['$scope', 'detailImageService', '$mdDialog', 'toaster','imageService'];\r\nexport {ImageDetailController}"]}